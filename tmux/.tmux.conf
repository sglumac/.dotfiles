###############################################################################
# PLUGIN INSTALLATION INSTRUCTIONS
###############################################################################
#
# FIRST-TIME SETUP:
# 1. Install the Tmux Plugin Manager (TPM):
#    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
#
# 2. Start a new tmux session or reload your current one:
#    tmux new-session
#    OR in an existing session: tmux source-file ~/.tmux.conf
#
# 3. Install plugins (inside tmux, press prefix + I):
#    Press: Ctrl-a I   (capital i, not lowercase L)
#
# 4. Verify plugins are working:
#    - tmux-resurrect: Save with prefix + Ctrl-s, restore with prefix + Ctrl-r
#    - tmux-continuum: Auto-saves every 15 minutes, auto-restores on start
#
# UPDATING PLUGINS:
# To update all plugins: Press prefix + U (capital u)
# To update a specific plugin: Press prefix + Alt-u (meta-u), select plugin
#
# REMOVING PLUGINS:
# 1. Remove from plugin list above
# 2. Press prefix + Alt-u (meta-u) to remove uninstalled plugins
# 3. Or manually delete from ~/.tmux/plugins/
#
# TROUBLESHOOTING:
# - If plugins don't load: Ensure the 'run' line below is at the VERY BOTTOM
# - If TPM not installed: Run step 1 above
# - If permission errors: chmod +x ~/.tmux/plugins/tpm/tpm
# - Manual install: Prefix + I sometimes needs to be pressed twice

# Set a more ergonomic prefix key
# Change prefix from Ctrl+b to Ctrl+a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Enable mouse support for easier navigation between panes and windows
set -g mouse on

# Set a more informative status bar
set -g status-bg colour235          # Background color of the status bar
set -g status-fg colour136          # Foreground color of the status bar
set -g status-left-length 40        # Length of left side of the status bar
set -g status-right-length 100      # Length of right side of the status bar
set -g status-interval 5            # Refresh interval for the status bar

# Status bar content
set -g status-left "#[fg=green]#S #[fg=white]❐ #[fg=yellow]%Y-%m-%d #[fg=cyan]%H:%M"
# Portable load average for Linux/macOS/BSD
set -g status-right "#[fg=cyan]#(whoami) #[fg=yellow]#H #[fg=green]#(uptime | awk '{print $(NF-2), $(NF-1), $(NF)}' | tr -d ',')"

# Window status formatting
set -g window-status-format "#I:#W"
set -g window-status-current-format "#I:#W#[fg=yellow]#F"

# Pane border styles for better visual feedback
set -g pane-border-style 'fg=colour240'
set -g pane-active-border-style 'fg=colour39'

# Split pane shortcuts
bind / split-window -h -c "#{pane_current_path}" # Split pane horizontally with Ctrl+a /
bind - split-window -v -c "#{pane_current_path}" # Split pane vertically with Ctrl+a -
unbind '"'                                       # Unbind default split (vertical) key
unbind %                                         # Unbind default split (horizontal) key

# Pane navigation using Vim-like shortcuts (with prefix)
bind -r h select-pane -L               # Move to the left pane (C-a h)
bind -r j select-pane -D               # Move to the pane below (C-a j)
bind -r k select-pane -U               # Move to the pane above (C-a k)
bind -r l select-pane -R               # Move to the right pane (C-a l)

# Resize panes with prefix + Ctrl + hjkl (C-a C-h, etc.)
bind -r C-h resize-pane -L
bind -r C-j resize-pane -D
bind -r C-k resize-pane -U
bind -r C-l resize-pane -R

# Enable synchronization across panes with visual feedback
bind S setw synchronize-panes\; display-message "synchronize-panes #{?synchronize-panes,ON,OFF}"

# Reload tmux configuration
bind r source-file ~/.tmux.conf \; display-message "Tmux config reloaded!"

# Quality-of-life shortcuts
bind d detach                      # Detach session with Ctrl+a d

# Set default terminal mode to 256 colors (improved compatibility)
set -g default-terminal "tmux-256color"

# Better escape time
set -s escape-time 10

# History scrollback limit
set -g history-limit 10000

# Use vi-style key bindings in copy mode
set -g mode-keys vi

# Copy to system clipboard (portable for Linux/macOS)
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i 2>/dev/null || pbcopy 2>/dev/null || cat > /dev/null"

# Mouse wheel scroll in copy mode
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

# Safer session management
bind x confirm-before -p "kill-session #S? (y/n)" kill-session

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Restore pane contents (history) if possible
set -g @resurrect-capture-pane-contents 'on'
# Restore nvim if possible
set -g @resurrect-processes 'nvim'
# Restore nvim session from Session.vim
set -g @resurrect-strategy-nvim 'session'

# Set a more ergonomic prefix key
# Change prefix from Ctrl+b to Ctrl+a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Enable mouse support for easier navigation between panes and windows
set -g mouse on

# Set a more informative status bar
set -g status-bg colour235          # Background color of the status bar
set -g status-fg colour136          # Foreground color of the status bar
set -g status-left-length 40        # Length of left side of the status bar
set -g status-right-length 100      # Length of right side of the status bar
set -g status-interval 5            # Refresh interval for the status bar

# Status bar content
set -g status-left "#[fg=green]#S #[fg=white]❐ #[fg=yellow]%Y-%m-%d #[fg=cyan]%H:%M"
# Portable load average for Linux/macOS/BSD
set -g status-right "#[fg=cyan]#(whoami) #[fg=yellow]#H #[fg=green]#(uptime | awk '{print $(NF-2), $(NF-1), $(NF)}' | tr -d ',')"

# Window status formatting
set -g window-status-format "#I:#W"
set -g window-status-current-format "#I:#W#[fg=yellow]#F"

# Pane border styles for better visual feedback
set -g pane-border-style 'fg=colour240'
set -g pane-active-border-style 'fg=colour39'

# Split pane shortcuts
bind / split-window -h -c "#{pane_current_path}" # Split pane horizontally with Ctrl+a /
bind - split-window -v -c "#{pane_current_path}" # Split pane vertically with Ctrl+a -
unbind '"'                                       # Unbind default split (vertical) key
unbind %                                         # Unbind default split (horizontal) key

# Pane navigation using Vim-like shortcuts (with prefix)
bind -r h select-pane -L               # Move to the left pane (C-a h)
bind -r j select-pane -D               # Move to the pane below (C-a j)
bind -r k select-pane -U               # Move to the pane above (C-a k)
bind -r l select-pane -R               # Move to the right pane (C-a l)

# Resize panes with prefix + Ctrl + hjkl (C-a C-h, etc.)
bind -r C-h resize-pane -L
bind -r C-j resize-pane -D
bind -r C-k resize-pane -U
bind -r C-l resize-pane -R

# Additional resize with arrow keys (optional, uncomment if wanted)
# bind -r Left resize-pane -L 2
# bind -r Down resize-pane -D 2
# bind -r Up resize-pane -U 2
# bind -r Right resize-pane -R 2

# Enable synchronization across panes with visual feedback
bind S setw synchronize-panes\; display-message "synchronize-panes #{?synchronize-panes,ON,OFF}"

# Reload tmux configuration
bind r source-file ~/.tmux.conf \; display-message "Tmux config reloaded!"

# Quality-of-life shortcuts
bind d detach                      # Detach session with Ctrl+a d

# Set default terminal mode to 256 colors (improved compatibility)
set -g default-terminal "tmux-256color"
# Fallback for older systems
# set -g default-terminal "screen-256color"

# Better escape time (prevents issues with some terminals)
set -s escape-time 10

# History scrollback limit
set -g history-limit 10000

# Use vi-style key bindings in copy mode
set -g mode-keys vi

# Copy to system clipboard (portable for Linux/macOS)
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i 2>/dev/null || pbcopy 2>/dev/null || cat > /dev/null"

# Mouse wheel scroll in copy mode
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'copy-mode -e'"

# Safer session management
bind x confirm-before -p "kill-session #S? (y/n)" kill-session

###############################################################################
# PLUGIN CONFIGURATION
###############################################################################

# List of plugins
set -g @plugin 'tmux-plugins/tpm'                 # Tmux Plugin Manager
set -g @plugin 'tmux-plugins/tmux-resurrect'      # Save/restore tmux sessions
set -g @plugin 'tmux-plugins/tmux-continuum'      # Auto-save and restore

# Plugin-specific configurations

# tmux-resurrect settings
set -g @resurrect-capture-pane-contents 'on'      # Save pane contents/history
set -g @resurrect-processes 'nvim'                # Restore nvim sessions
set -g @resurrect-strategy-nvim 'session'         # Use nvim's session file

# tmux-continuum settings (auto-save every 15 minutes)
set -g @continuum-restore 'on'                    # Auto-restore on tmux start
set -g @continuum-save-interval '15'              # Save every 15 minutes

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
